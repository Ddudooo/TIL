# 자바의 동기화 처리

싱글 스레드 프로그램에서는 한 개의 스레드가 객체를 독차지해서 사용하면 되지만,

멀티 스레드 프로그램에서는 스레드들이 객체를 공유해서 작업해야 하는 경우가 있다.

이 경우, 스레드 A를 사용하던 객체가 스레드 B에 의해 상태가 변경될 수 있기 때문에

스레드 A가 의도했던 것과는 다른 결과를 산출할 수도 있다.

이러한 문제를 해결하기 위해 스레드간 객체의 동기화 처리를 해줘야 하는데

자바에서는 기본적으로 `synchorized` 키워드를 통한 동기화 처리를 한다.

## synchorized

멀티 스레드 프로그램에서 단 하나의 스레드만 실행할 수 있는 코드 영역을 임계 영역(`critical section`)이라고 한다.

자바는 임계 영역을 저장하기 위해 동기화(synchronized) 메소드와 동기화 블록을 제공한다.

스레드가 객체 내부의 동기화 메소드 또는 블록에 들어가면 즉시 객체에 잠금을 걸어

다른 스레드가 임계 영역 코드를 실행하지 못하도록 한다.

동기화 메소드를 만드는 방법은 메소드 선언에 `synchronized` 키워드를 붙이면 된다.

`synchronized` 키워드는 인스턴스와 정적 메소드 어디든 붙일 수 있다.

* 단 하나의 스레드만 실행할 수 있는 메소드 또는 블록을 말한다.
* 다른 스레드는 메소드나 블록의 실행이 끝날 때까지 대기해야 한다.
* 동기화 메소드
    * 동기화 메소드는 메소드 전체 내용이 임계 영역이므로  
      스레드가 동기화 메소드를 실행하는 즉시 객체레는 잠금이 일어나고,  
      스레드가 동기화 메소드를 실행 종료하면 잠금이 풀린다.

## volatile

> 다중 쓰레드 환경에서의 변수의 불일치를 해결하기 위한 키워드

여러 스레드에서 같은 시점에 변수를 읽는 상태인 `경쟁 상태`와

변수의 사용될 수 있는 범위에서 문제인 가시성 문제가 생길 수 있는데

가시성 문제란

간단하게 변수의 값을 어느 메모리에서 가져오는지 알 수 없는 문제 이다.

volatile keyword는 Java 변수를 Main Memory에 저장하겠다라는 것을 명시하는 것

매번 변수의 값을 Read할 때마다 CPU cache에 저장된 값이 아닌 Main Memory에서 읽는 것

또한 변수의 값을 Write할 때마다 Main Memory에 까지 작성하는 것

